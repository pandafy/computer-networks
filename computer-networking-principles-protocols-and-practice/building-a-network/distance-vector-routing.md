# Distance Vector Routing

- Simple distributed routing protocol
- Allows router to automatically discover
  - the destinations reachable inside the network
  - shortest path to reach these destinations

**Note**: Each router maintains a [[routing-table]]

- A router that uses distance vector routing regularly sends it's distance vector overall all interfaces.

## Distance Vector

Distance vector is a summary of the router’s routing table that indicates the distance towards each known destination

Distance vector can be computed from the routing table by using the pseudo-code below.

```
Every N seconds:
 v=Vector()
 for d in R[]:
    # add destination d to vector
    v.add(Pair(d,R[d].cost))
 for i in interfaces
    # send vector v on this interface
    send(v,interface)
```

When a router receives a distance vector on link l, it processes it as follows.

```
# V : received Vector
# l : link over which vector is received
def received(V,l):
   # received vector from link l
   for d in V[]
     if not (d in R[]) :
        # new route
        R[d].cost=V[d].cost+l.cost
        R[d].link=l
        R[d].time=now
     else :
        # existing route, is the new better ?
        if ( ((V[d].cost+l.cost) < R[d].cost) or ( R[d].link == l) )  :
             # Better route or change to current route
             R[d].cost=V[d].cost+l.cost
             R[d].link=l
             R[d].time=now
```

- If the distance vector contains a destination that
  - the **router does not has in it's routing table**, the router simply adds the new address to it's routing table
  - the **router already has in it's routing table**, the router updates it's routing table on these two conditions:
    - the new route has smaller cost than already known router
    - the new route was learned over the same link

## Dealing with loss of a distance vector

- To deal with link and router failures, routers use the timestamp stored in their routing table.
- No router should have a timestamp older than **N** seconds, unless the router is not reachable anymore
- In practice, to cope with the possible loss of a distance vector due to transmission errors, routers check the timestamp of the routes stored in their routing table every **N** seconds
- Routers remove the routes that are older than **3×N** seconds.

## Dealing with lost links

- When a router notices that a route towards a destination has expired, it must first associate an ∞ cost to this route
- Sends its distance vector to its neighbors to inform them.
- The route can then be removed from the routing table after some time (e.g. 3×N seconds), to ensure that the neighboring routers have received the bad news, even if some distance vectors do not reach them due to transmission errors.

---

## [[count-to-infinity-problem]]

- Distance vector routing may suffer from count to infinity problems as soon as there is a cycle in the network
- To mitigate the impact of counting to infinity, some distance vector protocols consider that `16=∞`
- This limits the metrics that network operators can use and the diameter of the networks using distance vectors.

## Mitigating count to infinity: Split Horizon

- Modify the algorithm used to calculate the distance vector
- Instead of computing one distance vector and sending to all its neighbors, calculate distance vector for every neighbor individually
- The distance vector specific to a neighbor should not contain a route that was learnt through the same neighbor

Pseudocode:
```
# split horizon
Every N seconds:
# one vector for each interface
for l in interfaces:
  v=Vector()
  for d in R[]:
    if (R[d].link != l) :
       v=v+Pair(d,R[d.cost])
  send(v)
  # end for d in R[]
#end for l in interfaces
```

This technique is called [[split-horizon]]

## Split-horizon with Poison Reverse

```
# split horizon with poison reverse
Every N seconds:
 for l in interfaces:
   # one vector for each interface
   v=Vector()
   for d in R[]:
     if (R[d].link != l) :
        v=v+Pair(d,R[d.cost])
     else:
        v=v+Pair(d,infinity);
   send(v)
   # end for d in R[]
 #end for l in interfaces
```

[//begin]: # "Autogenerated link references for markdown compatibility"
[routing-table]: ../glossary/routing-table "Routing Table"
[count-to-infinity-problem]: ../glossary/count-to-infinity-problem "Count to Infinity Problem"
[//end]: # "Autogenerated link references"
